<div class="container-cliente flex flex-column gap-4">
  <span class="span-filtro">Clientes</span>
  <div class="container-filtro flex align-items-center justify-content-between">
    <form class="flex gap-3" [formGroup]="formFiltro">
      <div class="flex">
        <p-iconField iconPosition="left">
          <p-inputIcon styleClass="pi pi-search" />
          <input type="text" pInputText placeholder="Search" style="width: 350px;" formControlName="search" />
        </p-iconField>
      </div>
      <div class="flex gap-2">
        <p-button label="Buscar" [text]="true" [raised]="true" (click)="buscarClientesPaginado()" />
        <p-button icon="pi pi-eraser" [text]="true" [raised]="true" (click)="limparFormFiltro()" />
      </div>
    </form>
    <div class="adicionar-exportar flex gap-3">
      <p-button label="Adicionar" [raised]="true" icon="pi pi-plus" (onClick)="abrirDialogClientes()" />
      <p-button label="Exportar" [raised]="true" icon="pi pi-file-export" />
    </div>
  </div>
  <div class="container-tabela flex flex-column justify-content-between">
    <p-table [value]="clientes" [(selection)]="clientesSelecionados" dataKey="id" styleClass="p-datatable-striped"
      [tableStyle]="{'min-width': '50rem'}" scrollHeight="flex" [scrollable]="true" stickyHeader="true">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 5%;"><p-tableHeaderCheckbox /></th>
          <th style="width: 8%;">Código</th>
          <th style="width: 50%;">Nome</th>
          <th style="width: 12%;">Telefone</th>
          <th style="width: 15%; text-align: center;">Confiabilidade</th>
          <th style="width: 10%;">Ações</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-cliente>
        <tr>
          <td style="width: 5%;">
            <p-tableCheckbox [value]="cliente" />
          </td>
          <td style="width: 8%;">{{cliente.id}}</td>
          <td style="width: 50%;">{{cliente.nome}}</td>
          <td style="width: 12%;">{{cliente.telefone | phone}}</td>
          <td style="width: 15%; text-align: center;">
            @if(cliente.confiabilidade) {
            <span class="status" style="display: inline-block; align-items: center; width: 100%;">
              @for(star of filledStars(cliente.confiabilidade); track star) {
              <i class="pi pi-star-fill" style="font-size: 13px; color: yellow;"></i>
              }
              @for(star of emptyStars(cliente.confiabilidade); track star) {
              <i class="pi pi-star" style="font-size: 13px;"></i>
              }
            </span>
            }
          </td>
          <td style="width: 10%;" class="flex gap-2">
            <p-button pTooltip="Editar Informações Pessoais" icon="pi pi-pencil" [rounded]="true" [text]="true"
              [raised]="true" (onClick)="abrirDialogClientes(cliente.id)" />
            <p-button pTooltip="Gerenciar Empréstimos" icon="fa-solid fa-hand-holding-dollar" [rounded]="true"
              [text]="true" [raised]="true" (onClick)="navigate(cliente.id, 'emprestimos')" />
            <p-button pTooltip="Excluir Cliente" icon="pi pi-trash" [rounded]="true" [text]="true" [raised]="true"
              (onClick)="deletarCliente(cliente.id, cliente.nome)" severity="danger" />
          </td>
        </tr>
      </ng-template>
    </p-table>
    <p-paginator (onPageChange)="changePaginator($event)" [first]="1" [rows]="rows" [totalRecords]="totalElements"
      [rowsPerPageOptions]="[5, 7, 10, 20]" [style.font-size]="'12px'" />
  </div>
</div>

<p-dialog header="Edit Profile" [modal]="true" [(visible)]="dialogFormCliente" (onHide)="fecharDialogClientes()"
  [style]="{ width: '50rem' }" [maximizable]="true">
  <ng-template pTemplate="header">
    <div class="inline-flex align-items-center justify-content-center gap-2">
      <span class="font-bold white-space-nowrap">
        {{titleDialog}}
      </span>
    </div>
  </ng-template>
  <form class="formCliente grid flex w-full" [formGroup]="formCliente">
    <div class="flex flex-column gap-2 col-12 sm:col-7">
      <label for="nome">Nome</label>
      <input pInputText id="nome" formControlName="nome" />
    </div>
    <div class="flex flex-column gap-2 col-12 sm:col-5">
      <label for="telefone">Telefone</label>
      <p-inputMask mask="(99) 99999-9999" placeholder="(99) 99999-9999" [style.width]="'100%'"
        formControlName="telefone" />
    </div>
    <div class="flex flex-column gap-2 col-12 sm:col-6">
      <label for="recomendante">Recomendante</label>
      <input pInputText id="recomendante" formControlName="recomendante" />
    </div>
    <div class="flex flex-column gap-2 col-12 sm:col-6">
      <label for="endereco">Endereço</label>
      <input pInputText id="endereco" formControlName="endereco" />
    </div>
    <div class="flex flex-column gap-2 col-12 sm:col-5">
      <label for="cidade">Cidade</label>
      <input pInputText id="cidade" formControlName="cidade" />
    </div>
    <div class="flex flex-column gap-2 col-12 sm:col-5">
      <label for="bairro">Bairro</label>
      <input pInputText id="bairro" formControlName="bairro" />
    </div>
    <div class="flex flex-column gap-2 col-12 sm:col-2">
      <label for="numero">Numero</label>
      <input pInputText id="numero" formControlName="numero" />
    </div>
    <div class="flex flex-column gap-2 col-12">
      <label for="complemento">Complemento / Ponto de Referência</label>
      <input pInputText id="complemento" formControlName="complemento" />
    </div>
  </form>
  <ng-template pTemplate="footer">
    <p-button label="Cancelar" severity="secondary" (onClick)="fecharDialogClientes()" />
    <p-button label="Salvar" (onClick)="salvarCliente()" />
  </ng-template>
</p-dialog>
<p-confirmDialog #cd>
  <ng-template pTemplate="headless" let-message>
    <div class="flex flex-column align-items-center p-5 surface-overlay border-round">
      <div class="border-circle bg-primary inline-flex justify-content-center align-items-center h-6rem w-6rem">
        <i class="pi pi-exclamation-triangle text-5xl"></i>
      </div>
      <span class="font-bold text-2xl block mb-2 mt-4">
        {{ message.header }}
      </span>
      <p class="mb-0">{{ message.message }}</p>
      <div class="flex align-items-center gap-2 mt-4">
        <button pButton label="Cancelar" (click)="cd.reject()" class="p-button-outlined w-8rem ">
        </button>
        <button pButton label="Confirmar" (click)="cd.accept()" class="w-8rem">
        </button>
      </div>
    </div>
  </ng-template>
</p-confirmDialog>
<p-toast />